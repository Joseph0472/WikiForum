{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __spreadArrays = this && this.__spreadArrays || function () {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n\n  for (var r = Array(s), k = 0, i = 0; i < il; i++) for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) r[k] = a[j];\n\n  return r;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nexports.__esModule = true;\n\nvar react_1 = __importDefault(require(\"react\"));\n\nvar Mark_1 = __importDefault(require(\"./Mark\"));\n\nvar utils_1 = require(\"./utils\");\n\nvar Split = function (props) {\n  if (props.mark) return react_1[\"default\"].createElement(Mark_1[\"default\"], __assign({}, props));\n  return react_1[\"default\"].createElement(\"span\", {\n    \"data-start\": props.start,\n    \"data-end\": props.end,\n    onClick: function () {\n      return props.onClick({\n        start: props.start,\n        end: props.end\n      });\n    }\n  }, props.content);\n};\n\nvar TextAnnotator = function (props) {\n  var getSpan = function (span) {\n    // TODO: Better typings here.\n    if (props.getSpan) return props.getSpan(span);\n    return {\n      start: span.start,\n      end: span.end\n    };\n  };\n\n  var handleMouseUp = function () {\n    var _a;\n\n    if (!props.onChange) return;\n    var selection = window.getSelection();\n    if (utils_1.selectionIsEmpty(selection)) return;\n    var start = parseInt(selection.anchorNode.parentElement.getAttribute('data-start'), 10) + selection.anchorOffset;\n    var end = parseInt(selection.focusNode.parentElement.getAttribute('data-start'), 10) + selection.focusOffset;\n\n    if (utils_1.selectionIsBackwards(selection)) {\n      ;\n      _a = [end, start], start = _a[0], end = _a[1];\n    }\n\n    props.onChange(__spreadArrays(props.value, [getSpan({\n      start: start,\n      end: end,\n      text: content.slice(start, end)\n    })]));\n    window.getSelection().empty();\n  };\n\n  var handleSplitClick = function (_a) {\n    var start = _a.start,\n        end = _a.end; // Find and remove the matching split.\n\n    var splitIndex = props.value.findIndex(function (s) {\n      return s.start === start && s.end === end;\n    });\n\n    if (splitIndex >= 0) {\n      props.onChange(__spreadArrays(props.value.slice(0, splitIndex), props.value.slice(splitIndex + 1)));\n    }\n  };\n\n  var content = props.content,\n      value = props.value,\n      style = props.style;\n  var splits = utils_1.splitWithOffsets(content, value);\n  return react_1[\"default\"].createElement(\"div\", {\n    style: style,\n    onMouseUp: handleMouseUp\n  }, splits.map(function (split) {\n    return react_1[\"default\"].createElement(Split, __assign({\n      key: split.start + \"-\" + split.end\n    }, split, {\n      onClick: handleSplitClick\n    }));\n  }));\n};\n\nexports[\"default\"] = TextAnnotator;","map":{"version":3,"sources":["../src/TextAnnotator.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nexports.__esModule = true;\nvar react_1 = __importDefault(require(\"react\"));\nvar Mark_1 = __importDefault(require(\"./Mark\"));\nvar utils_1 = require(\"./utils\");\nvar Split = function (props) {\n    if (props.mark)\n        return react_1[\"default\"].createElement(Mark_1[\"default\"], __assign({}, props));\n    return (react_1[\"default\"].createElement(\"span\", { \"data-start\": props.start, \"data-end\": props.end, onClick: function () { return props.onClick({ start: props.start, end: props.end }); } }, props.content));\n};\nvar TextAnnotator = function (props) {\n    var getSpan = function (span) {\n        // TODO: Better typings here.\n        if (props.getSpan)\n            return props.getSpan(span);\n        return { start: span.start, end: span.end };\n    };\n    var handleMouseUp = function () {\n        var _a;\n        if (!props.onChange)\n            return;\n        var selection = window.getSelection();\n        if (utils_1.selectionIsEmpty(selection))\n            return;\n        var start = parseInt(selection.anchorNode.parentElement.getAttribute('data-start'), 10) +\n            selection.anchorOffset;\n        var end = parseInt(selection.focusNode.parentElement.getAttribute('data-start'), 10) +\n            selection.focusOffset;\n        if (utils_1.selectionIsBackwards(selection)) {\n            ;\n            _a = [end, start], start = _a[0], end = _a[1];\n        }\n        props.onChange(__spreadArrays(props.value, [getSpan({ start: start, end: end, text: content.slice(start, end) })]));\n        window.getSelection().empty();\n    };\n    var handleSplitClick = function (_a) {\n        var start = _a.start, end = _a.end;\n        // Find and remove the matching split.\n        var splitIndex = props.value.findIndex(function (s) { return s.start === start && s.end === end; });\n        if (splitIndex >= 0) {\n            props.onChange(__spreadArrays(props.value.slice(0, splitIndex), props.value.slice(splitIndex + 1)));\n        }\n    };\n    var content = props.content, value = props.value, style = props.style;\n    var splits = utils_1.splitWithOffsets(content, value);\n    return (react_1[\"default\"].createElement(\"div\", { style: style, onMouseUp: handleMouseUp }, splits.map(function (split) { return (react_1[\"default\"].createElement(Split, __assign({ key: split.start + \"-\" + split.end }, split, { onClick: handleSplitClick }))); })));\n};\nexports[\"default\"] = TextAnnotator;\n//# sourceMappingURL=TextAnnotator.js.map"]},"metadata":{},"sourceType":"script"}